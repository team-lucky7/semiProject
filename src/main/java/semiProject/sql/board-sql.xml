<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>

	<comment>board-sql.xml</comment>
	
	<!-- 게시판 이름 조회 -->
	<entry key="selectBoardName">
		SELECT BOARD_NM FROM BOARD_TYPE WHERE BOARD_CD = ?
	</entry>
	
	<!-- 특정 게시판의 전체 게시글 수 조회 -->
	<entry key="getListCount">
		SELECT COUNT(*) FROM BOARD WHERE BOARD_ST = 'N' AND BOARD_CD = ?
	</entry>
	
	<!-- 특정 게시판에서 일정한 범위의 목록 조회 -->
	<entry key="selectBoardList">
		SELECT * FROM(
		    SELECT ROWNUM AS RNUM, A.* FROM (
		        SELECT BOARD_NO, BOARD_TITLE, MEMBER_NM,
		            TO_CHAR(CREATE_DT, 'YYYY-MM-DD') CREATE_DT,
		            READ_COUNT, COUNT(BOARD_REPLY_NO) LIKE_COUNT
		        FROM BOARD
		        JOIN MEMBER USING(MEMBER_NO)
		        LEFT JOIN "LIKE" ON(BOARD_REPLY_NO = BOARD_NO)
		        WHERE BOARD_CD = ?
		        AND BOARD_ST = 'N'
		        GROUP BY BOARD_NO, BOARD_TITLE, MEMBER_NM,
		            TO_CHAR(CREATE_DT, 'YYYY-MM-DD'), READ_COUNT
		        ORDER BY BOARD_NO DESC
		    )A
		)
		WHERE RNUM BETWEEN ? AND ?
	</entry>
	
	<!-- 게시글 상세조회 -->
	<entry key="selectBoardDetail">
		SELECT BOARD_NO, BOARD_NM, BOARD_TITLE,
		    BOARD_CONTENT, PROFILE_IMG, MEMBER_NM,
		    TO_CHAR(CREATE_DT, 'YYYY-MM-DD') CREATE_DT,
		    TO_CHAR(UPDATE_DT, 'YYYY-MM-DD') UPDATE_DT,
		    READ_COUNT, B.MEMBER_NO, LOCATION_NM, COUNT(BOARD_REPLY_NO) LIKE_COUNT
		FROM BOARD B
		JOIN BOARD_TYPE USING(BOARD_CD)
        LEFT JOIN "LIKE" ON(BOARD_NO = BOARD_REPLY_NO)
        LEFT JOIN LOCATION USING(LOCATION_CODE)
		JOIN MEMBER M ON(B.MEMBER_NO = M.MEMBER_NO)
		WHERE BOARD_NO = ?
        GROUP BY BOARD_NO, BOARD_NM, BOARD_TITLE,
		    BOARD_CONTENT, PROFILE_IMG, MEMBER_NM,
		    TO_CHAR(CREATE_DT, 'YYYY-MM-DD'),
		    TO_CHAR(UPDATE_DT, 'YYYY-MM-DD'),
		    READ_COUNT, B.MEMBER_NO, LOCATION_NM
	</entry>
	
	<!-- 게시글 내용(글) 조회 -->
	<entry key="selectBoardArticle">
		SELECT BOARD_CT_NO, CONTENT, CONTENT_SIZE, CONTENT_LEVEL FROM BOARD_ARTICLE WHERE BOARD_NO = ?
	</entry>
	
	<!-- 게시글 내용(사진) 조회 -->
	<entry key="selectBoardImage">
		SELECT IMG_NO, IMG_SIZE, IMG_RENAME, IMG_ORIGINAL, IMG_LEVEL FROM BOARD_IMG WHERE BOARD_NO = ?
	</entry>
	
	<!-- 좋아요 여부 조회 -->
	<entry key="getIsLike">
		SELECT COUNT(*) FROM "LIKE" WHERE BOARD_REPLY_NO = ? AND MEMBER_NO = ?
	</entry>
	
	<!-- 검색 시 특정 게시판의 전체 게시글 수 조회 -->
	<entry key="getSearchListCount">
		SELECT COUNT(COUNT(*))FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		LEFT JOIN BOARD_ARTICLE USING(BOARD_NO)
		WHERE BOARD_ST = 'N' AND BOARD_CD = ? AND
		    (BOARD_TITLE LIKE ? OR 
		    BOARD_CONTENT LIKE ? OR CONTENT LIKE ? OR MEMBER_NM LIKE ?)
		GROUP BY BOARD_NO
	</entry>
	
	<!-- 검색 시 특정 게시판에서 일정한 범위의 목록 조회 -->
	<entry key="searchBoardList">
		SELECT * FROM(
		    SELECT ROWNUM AS RNUM, A.*, (SELECT IMG_RENAME FROM BOARD_IMG
		                WHERE IMG_LEVEL = 0
		                AND BOARD_IMG.BOARD_NO = A.BOARD_NO) THUMBNAIL FROM (
		        SELECT BOARD_NO, BOARD_TITLE, MEMBER_NM,
		            TO_CHAR(CREATE_DT, 'YYYY-MM-DD') CREATE_DT,
		            READ_COUNT, COUNT(BOARD_REPLY_NO) LIKE_COUNT
		        FROM BOARD
		        JOIN MEMBER USING(MEMBER_NO)
		        LEFT JOIN "LIKE" ON(BOARD_REPLY_NO = BOARD_NO)
                LEFT JOIN BOARD_ARTICLE USING(BOARD_NO)
		        WHERE BOARD_CD = ?
		        AND BOARD_ST = 'N'
                AND (BOARD_TITLE LIKE ? OR 
                     BOARD_CONTENT LIKE ? OR CONTENT LIKE ? OR MEMBER_NM LIKE ?)
		        GROUP BY BOARD_NO, BOARD_TITLE, MEMBER_NM,
		            TO_CHAR(CREATE_DT, 'YYYY-MM-DD'), READ_COUNT
		        ORDER BY BOARD_NO DESC
		    )A
		)
        WHERE RNUM BETWEEN ? AND ?		
	</entry>
	
	<!-- 조회수 증가 -->
	<entry key="increaseReadCount">
		UPDATE BOARD SET READ_COUNT = READ_COUNT + 1 WHERE BOARD_NO = ?
	</entry>
	
	<!-- 게시글 삭제 -->
	<entry key="deleteBoard">
		UPDATE BOARD SET BOARD_ST = 'Y' WHERE BOARD_NO = ?
	</entry>
	
<!-- 지역 게시글 상세조회 -->	
<entry key="regionBoardDetail">
	SELECT BOARD_NO,BOARD_TITLE,LOCATION_NM,BOARD_CONTENT,CONTENT
	FROM BOARD
	JOIN LOCATION USING(LOCATION_CODE)
	LEFT JOIN BOARD_ARTICLE USING(BOARD_NO)
	WHERE BOARD_NO = ?
</entry>	


<!-- 지역 게시글 이미지 조회  -->
<entry key="selectRegionImageList">
	SELECT *
	FROM BOARD_IMG
	WHERE BOARD_NO = ?
	ORDER BY IMG_LEVEL
</entry>


<!-- 다음 게시글 번호 조회  -->
<entry key="regionnextBoardNo">
	SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
</entry>

<!-- 지역 게시글 삽입 -->
<entry key="regioninsertBoard">
	INSERT INTO BOARD 
	VALUES(?,?,?,DEFAULT,DEFAULT,DEFAULT,DEFAULT,?,1,?)
</entry>

<entry key="regioninsertBoard2">
	INSERT INTO BOARD_ARTICLE VALUES(0,?,0,0,?)
</entry>
	
<!--지역 게시글 이미지 삽입  -->
<entry key="regioninsertBoardImage">
	INSERT INTO BOARD_IMG
	VALUES(SEQ_IMG_NO.NEXTVAL, 1 , ? , ? , ?, ?)
</entry>

<!-- 지역 게시글 조회 1 -->
<entry key="searchRegionBoardList">
	SELECT  BOARD_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_CD
	FROM BOARD
	WHERE BOARD_CD IN(
</entry>	

<!-- 지역 게시글 조회 2 -->
<entry key="searchRegionBoardList2">
	)
	AND BOARD_ST = 'N'
	ORDER BY BOARD_NO DESC
</entry>	
	
	
	
</properties>
